// This is your Prisma schema file

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id              String             @id @default(uuid())
  githubId        String             @unique
  githubUsername  String
  email           String?
  avatarUrl       String?
  createdAt       DateTime           @default(now())
  updatedAt       DateTime           @updatedAt

  workspaces      WorkspaceMember[]

  @@map("users")
}

model Workspace {
  id              String             @id @default(uuid())
  name            String
  createdAt       DateTime           @default(now())
  updatedAt       DateTime           @updatedAt

  members         WorkspaceMember[]
  dailyLogs       DailyLog[]

  @@map("workspaces")
}

enum WorkspaceRole {
  OWNER
  ADMIN
  MEMBER
}

model WorkspaceMember {
  id              String           @id @default(uuid())
  userId          String
  workspaceId     String
  role            WorkspaceRole    @default(MEMBER)
  joinedAt        DateTime         @default(now())

  user            User             @relation(fields: [userId], references: [id], onDelete: Cascade)
  workspace       Workspace        @relation(fields: [workspaceId], references: [id], onDelete: Cascade)

  @@unique([userId, workspaceId])
  @@map("workspace_members")
}

model DailyLog {
  id              String           @id @default(uuid())
  workspaceId     String
  date            DateTime         @db.Date
  content         String           @db.Text
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt

  workspace       Workspace        @relation(fields: [workspaceId], references: [id], onDelete: Cascade)

  @@unique([workspaceId, date])
  @@index([workspaceId, date])
  @@map("daily_logs")
}
